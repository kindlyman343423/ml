// ml@v0.0.5, MIT licensed. https://github.com/mljs/ml
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.ML=t()}}(function(){var define,module,exports;return function t(r,o,i){function n(e,a){if(!o[e]){if(!r[e]){var h="function"==typeof require&&require;if(!a&&h)return h(e,!0);if(s)return s(e,!0);var f=new Error("Cannot find module '"+e+"'");throw f.code="MODULE_NOT_FOUND",f}var u=o[e]={exports:{}};r[e][0].call(u.exports,function(t){var o=r[e][1][t];return n(o?o:t)},u,u.exports,t,r,o,i)}return o[e].exports}for(var s="function"==typeof require&&require,e=0;e<i.length;e++)n(i[e]);return n}({1:[function(t,r,o){o.Matrix=t("ml-matrix");var i={};i.SOM=t("ml-som"),o.nn=i},{"ml-matrix":3,"ml-som":5}],2:[function(t,r){"use strict";function o(t){if(t=g.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");var r,o,a=t.columns,f=g.zeros(a,a),u=new Array(a),c=new Array(a),m=t;if(t.isSymmetric()){for(r=0;a>r;r++)for(o=0;a>o;o++)f[r][o]=m[r][o];i(a,c,u,f),n(a,c,u,f)}else{var l=g.zeros(a,a),p=new Array(a);for(o=0;a>o;o++)for(r=0;a>r;r++)l[r][o]=m[r][o];s(a,l,p,f),e(a,c,u,f,l)}return new h(a,c,u,f)}function i(t,r,o,i){var n,s,e,a,h,f,u,c;for(h=0;t>h;h++)o[h]=i[t-1][h];for(a=t-1;a>0;a--){for(c=0,e=0,f=0;a>f;f++)c+=Math.abs(o[f]);if(0===c)for(r[a]=o[a-1],h=0;a>h;h++)o[h]=i[a-1][h],i[a][h]=0,i[h][a]=0;else{for(f=0;a>f;f++)o[f]/=c,e+=o[f]*o[f];for(n=o[a-1],s=Math.sqrt(e),n>0&&(s=-s),r[a]=c*s,e-=n*s,o[a-1]=n-s,h=0;a>h;h++)r[h]=0;for(h=0;a>h;h++){for(n=o[h],i[h][a]=n,s=r[h]+i[h][h]*n,f=h+1;a-1>=f;f++)s+=i[f][h]*o[f],r[f]+=i[f][h]*n;r[h]=s}for(n=0,h=0;a>h;h++)r[h]/=e,n+=r[h]*o[h];for(u=n/(e+e),h=0;a>h;h++)r[h]-=u*o[h];for(h=0;a>h;h++){for(n=o[h],s=r[h],f=h;a-1>=f;f++)i[f][h]-=n*r[f]+s*o[f];o[h]=i[a-1][h],i[a][h]=0}}o[a]=e}for(a=0;t-1>a;a++){if(i[t-1][a]=i[a][a],i[a][a]=1,e=o[a+1],0!==e){for(f=0;a>=f;f++)o[f]=i[f][a+1]/e;for(h=0;a>=h;h++){for(s=0,f=0;a>=f;f++)s+=i[f][a+1]*i[f][h];for(f=0;a>=f;f++)i[f][h]-=s*o[f]}}for(f=0;a>=f;f++)i[f][a+1]=0}for(h=0;t>h;h++)o[h]=i[t-1][h],i[t-1][h]=0;i[t-1][t-1]=1,r[0]=0}function n(t,r,o,i){var n,s,e,a,h,f,u,c,m,l,p,d,w,v,M,g,x;for(e=1;t>e;e++)r[e-1]=r[e];r[t-1]=0;var b=0,R=0,k=Math.pow(2,-52);for(f=0;t>f;f++){for(R=Math.max(R,Math.abs(o[f])+Math.abs(r[f])),u=f;t>u&&!(Math.abs(r[u])<=k*R);)u++;if(u>f){x=0;do{for(x+=1,n=o[f],c=(o[f+1]-n)/(2*r[f]),m=y(c,1),0>c&&(m=-m),o[f]=r[f]/(c+m),o[f+1]=r[f]*(c+m),l=o[f+1],s=n-o[f],e=f+2;t>e;e++)o[e]-=s;for(b+=s,c=o[u],p=1,d=p,w=p,v=r[f+1],M=0,g=0,e=u-1;e>=f;e--)for(w=d,d=p,g=M,n=p*r[e],s=p*c,m=y(c,r[e]),r[e+1]=M*m,M=r[e]/m,p=c/m,c=p*o[e]-M*n,o[e+1]=s+M*(p*n+M*o[e]),h=0;t>h;h++)s=i[h][e+1],i[h][e+1]=M*i[h][e]+p*s,i[h][e]=p*i[h][e]-M*s;c=-M*g*w*v*r[f]/l,r[f]=M*c,o[f]=p*c}while(Math.abs(r[f])>k*R)}o[f]=o[f]+b,r[f]=0}for(e=0;t-1>e;e++){for(h=e,c=o[e],a=e+1;t>a;a++)o[a]<c&&(h=a,c=o[a]);if(h!==e)for(o[h]=o[e],o[e]=c,a=0;t>a;a++)c=i[a][e],i[a][e]=i[a][h],i[a][h]=c}}function s(t,r,o,i){var n,s,e,a,h,f,u,c=0,m=t-1;for(f=c+1;m-1>=f;f++){for(u=0,a=f;m>=a;a++)u+=Math.abs(r[a][f-1]);if(0!==u){for(e=0,a=m;a>=f;a--)o[a]=r[a][f-1]/u,e+=o[a]*o[a];for(s=Math.sqrt(e),o[f]>0&&(s=-s),e-=o[f]*s,o[f]=o[f]-s,h=f;t>h;h++){for(n=0,a=m;a>=f;a--)n+=o[a]*r[a][h];for(n/=e,a=f;m>=a;a++)r[a][h]-=n*o[a]}for(a=0;m>=a;a++){for(n=0,h=m;h>=f;h--)n+=o[h]*r[a][h];for(n/=e,h=f;m>=h;h++)r[a][h]-=n*o[h]}o[f]=u*o[f],r[f][f-1]=u*s}}for(a=0;t>a;a++)for(h=0;t>h;h++)i[a][h]=a===h?1:0;for(f=m-1;f>=c+1;f--)if(0!==r[f][f-1]){for(a=f+1;m>=a;a++)o[a]=r[a][f-1];for(h=f;m>=h;h++){for(s=0,a=f;m>=a;a++)s+=o[a]*i[a][h];for(s=s/o[f]/r[f][f-1],a=f;m>=a;a++)i[a][h]+=s*o[a]}}}function e(t,r,o,i,n){var s,e,h,f,u,c,m,l,p,d,w,y,v,M,g,x=t-1,b=0,R=t-1,k=Math.pow(2,-52),D=0,A=0,S=0,j=0,O=0,C=0,I=0,V=0;for(s=0;t>s;s++)for((b>s||s>R)&&(o[s]=n[s][s],r[s]=0),e=Math.max(s-1,0);t>e;e++)A+=Math.abs(n[s][e]);for(;x>=b;){for(f=x;f>b&&(C=Math.abs(n[f-1][f-1])+Math.abs(n[f][f]),0===C&&(C=A),!(Math.abs(n[f][f-1])<k*C));)f--;if(f===x)n[x][x]=n[x][x]+D,o[x]=n[x][x],r[x]=0,x--,V=0;else if(f===x-1){if(m=n[x][x-1]*n[x-1][x],S=(n[x-1][x-1]-n[x][x])/2,j=S*S+m,I=Math.sqrt(Math.abs(j)),n[x][x]=n[x][x]+D,n[x-1][x-1]=n[x-1][x-1]+D,l=n[x][x],j>=0){for(I=S>=0?S+I:S-I,o[x-1]=l+I,o[x]=o[x-1],0!==I&&(o[x]=l-m/I),r[x-1]=0,r[x]=0,l=n[x][x-1],C=Math.abs(l)+Math.abs(I),S=l/C,j=I/C,O=Math.sqrt(S*S+j*j),S/=O,j/=O,e=x-1;t>e;e++)I=n[x-1][e],n[x-1][e]=j*I+S*n[x][e],n[x][e]=j*n[x][e]-S*I;for(s=0;x>=s;s++)I=n[s][x-1],n[s][x-1]=j*I+S*n[s][x],n[s][x]=j*n[s][x]-S*I;for(s=b;R>=s;s++)I=i[s][x-1],i[s][x-1]=j*I+S*i[s][x],i[s][x]=j*i[s][x]-S*I}else o[x-1]=l+S,o[x]=l+S,r[x-1]=I,r[x]=-I;x-=2,V=0}else{if(l=n[x][x],p=0,m=0,x>f&&(p=n[x-1][x-1],m=n[x][x-1]*n[x-1][x]),10===V){for(D+=l,s=b;x>=s;s++)n[s][s]-=l;C=Math.abs(n[x][x-1])+Math.abs(n[x-1][x-2]),l=p=.75*C,m=-.4375*C*C}if(30===V&&(C=(p-l)/2,C=C*C+m,C>0)){for(C=Math.sqrt(C),l>p&&(C=-C),C=l-m/((p-l)/2+C),s=b;x>=s;s++)n[s][s]-=C;D+=C,l=p=m=.964}for(V+=1,u=x-2;u>=f&&(I=n[u][u],O=l-I,C=p-I,S=(O*C-m)/n[u+1][u]+n[u][u+1],j=n[u+1][u+1]-I-O-C,O=n[u+2][u+1],C=Math.abs(S)+Math.abs(j)+Math.abs(O),S/=C,j/=C,O/=C,u!==f)&&!(Math.abs(n[u][u-1])*(Math.abs(j)+Math.abs(O))<k*Math.abs(S)*(Math.abs(n[u-1][u-1])+Math.abs(I)+Math.abs(n[u+1][u+1])));)u--;for(s=u+2;x>=s;s++)n[s][s-2]=0,s>u+2&&(n[s][s-3]=0);for(h=u;x-1>=h&&(M=h!==x-1,h!==u&&(S=n[h][h-1],j=n[h+1][h-1],O=M?n[h+2][h-1]:0,l=Math.abs(S)+Math.abs(j)+Math.abs(O),0!==l&&(S/=l,j/=l,O/=l)),0!==l);h++)if(C=Math.sqrt(S*S+j*j+O*O),0>S&&(C=-C),0!==C){for(h!==u?n[h][h-1]=-C*l:f!==u&&(n[h][h-1]=-n[h][h-1]),S+=C,l=S/C,p=j/C,I=O/C,j/=S,O/=S,e=h;t>e;e++)S=n[h][e]+j*n[h+1][e],M&&(S+=O*n[h+2][e],n[h+2][e]=n[h+2][e]-S*I),n[h][e]=n[h][e]-S*l,n[h+1][e]=n[h+1][e]-S*p;for(s=0;s<=Math.min(x,h+3);s++)S=l*n[s][h]+p*n[s][h+1],M&&(S+=I*n[s][h+2],n[s][h+2]=n[s][h+2]-S*O),n[s][h]=n[s][h]-S,n[s][h+1]=n[s][h+1]-S*j;for(s=b;R>=s;s++)S=l*i[s][h]+p*i[s][h+1],M&&(S+=I*i[s][h+2],i[s][h+2]=i[s][h+2]-S*O),i[s][h]=i[s][h]-S,i[s][h+1]=i[s][h+1]-S*j}}}if(0!==A){for(x=t-1;x>=0;x--)if(S=o[x],j=r[x],0===j)for(f=x,n[x][x]=1,s=x-1;s>=0;s--){for(m=n[s][s]-S,O=0,e=f;x>=e;e++)O+=n[s][e]*n[e][x];if(r[s]<0)I=m,C=O;else if(f=s,0===r[s]?n[s][x]=0!==m?-O/m:-O/(k*A):(l=n[s][s+1],p=n[s+1][s],j=(o[s]-S)*(o[s]-S)+r[s]*r[s],c=(l*C-I*O)/j,n[s][x]=c,n[s+1][x]=Math.abs(l)>Math.abs(I)?(-O-m*c)/l:(-C-p*c)/I),c=Math.abs(n[s][x]),k*c*c>1)for(e=s;x>=e;e++)n[e][x]=n[e][x]/c}else if(0>j)for(f=x-1,Math.abs(n[x][x-1])>Math.abs(n[x-1][x])?(n[x-1][x-1]=j/n[x][x-1],n[x-1][x]=-(n[x][x]-S)/n[x][x-1]):(g=a(0,-n[x-1][x],n[x-1][x-1]-S,j),n[x-1][x-1]=g[0],n[x-1][x]=g[1]),n[x][x-1]=0,n[x][x]=1,s=x-2;s>=0;s--){for(d=0,w=0,e=f;x>=e;e++)d+=n[s][e]*n[e][x-1],w+=n[s][e]*n[e][x];if(m=n[s][s]-S,r[s]<0)I=m,O=d,C=w;else if(f=s,0===r[s]?(g=a(-d,-w,m,j),n[s][x-1]=g[0],n[s][x]=g[1]):(l=n[s][s+1],p=n[s+1][s],y=(o[s]-S)*(o[s]-S)+r[s]*r[s]-j*j,v=2*(o[s]-S)*j,0===y&&0===v&&(y=k*A*(Math.abs(m)+Math.abs(j)+Math.abs(l)+Math.abs(p)+Math.abs(I))),g=a(l*O-I*d+j*w,l*C-I*w-j*d,y,v),n[s][x-1]=g[0],n[s][x]=g[1],Math.abs(l)>Math.abs(I)+Math.abs(j)?(n[s+1][x-1]=(-d-m*n[s][x-1]+j*n[s][x])/l,n[s+1][x]=(-w-m*n[s][x]-j*n[s][x-1])/l):(g=a(-O-p*n[s][x-1],-C-p*n[s][x],I,j),n[s+1][x-1]=g[0],n[s+1][x]=g[1])),c=Math.max(Math.abs(n[s][x-1]),Math.abs(n[s][x])),k*c*c>1)for(e=s;x>=e;e++)n[e][x-1]=n[e][x-1]/c,n[e][x]=n[e][x]/c}for(s=0;t>s;s++)if(b>s||s>R)for(e=s;t>e;e++)i[s][e]=n[s][e];for(e=t-1;e>=b;e--)for(s=b;R>=s;s++){for(I=0,h=b;h<=Math.min(e,R);h++)I+=i[s][h]*n[h][e];i[s][e]=I}}}function a(t,r,o,i){var n,s;return Math.abs(o)>Math.abs(i)?(n=i/o,s=o+n*i,[(t+n*r)/s,(r-n*t)/s]):(n=o/i,s=i+n*o,[(n*t+r)/s,(n*r-t)/s])}function h(t,r,o,i){this.n=t,this.e=r,this.d=o,this.V=i}function f(t){t=g.checkMatrix(t);var r,o,i,n,s,e,a,h,f,c,m=t.clone(),l=m.rows,p=m.columns,d=new Array(l),w=1;for(r=0;l>r;r++)d[r]=r;for(f=new Array(l),o=0;p>o;o++){for(r=0;l>r;r++)f[r]=m[r][o];for(r=0;l>r;r++){for(h=m[r],c=Math.min(r,o),s=0,i=0;c>i;i++)s+=h[i]*f[i];h[o]=f[r]-=s}for(n=o,r=o+1;l>r;r++)Math.abs(f[r])>Math.abs(f[n])&&(n=r);if(n!==o){for(i=0;p>i;i++)e=m[n][i],m[n][i]=m[o][i],m[o][i]=e;a=d[n],d[n]=d[o],d[o]=a,w=-w}if(l>o&&0!==m[o][o])for(r=o+1;l>r;r++)m[r][o]/=m[o][o]}return new u(m,d,w)}function u(t,r,o){this.LU=t,this.pivotVector=r,this.pivotSign=o}function c(t){t=g.checkMatrix(t);var r,o,i,n,s=t.clone(),e=t.rows,a=t.columns,h=new Array(a);for(i=0;a>i;i++){var f=0;for(r=i;e>r;r++)f=y(f,s[r][i]);if(0!==f){for(s[i][i]<0&&(f=-f),r=i;e>r;r++)s[r][i]/=f;for(s[i][i]+=1,o=i+1;a>o;o++){for(n=0,r=i;e>r;r++)n+=s[r][i]*s[r][o];for(n=-n/s[i][i],r=i;e>r;r++)s[r][o]+=n*s[r][i]}}h[i]=-f}return new m(s,h)}function m(t,r){this.QR=t,this.Rdiag=r}function l(t,r){t=g.checkMatrix(t),r=r||{};var o=t.clone(),i=t.rows,n=t.columns,s=Math.min(i,n),e=!0,a=!0;r.computeLeftSingularVectors===!1&&(e=!1),r.computeRightSingularVectors===!1&&(a=!1);var h=r.autoTranspose===!0,f=!1;if(n>i)if(h){o=o.transpose(),i=o.rows,n=o.columns,f=!0;var u=e;e=a,a=u}else console.warn("WARNING: Computing SVD on a matrix with more columns than rows.");var c,m,l,d,w,v,M,x,b,R,k,D,A,S,j,O,C,I,V,q,z,E=new Array(Math.min(i+1,n)),U=g.zeros(i,s),L=g.zeros(n,n),_=new Array(n),N=new Array(i),T=Math.min(i-1,n),P=Math.max(0,Math.min(n-2,i));for(l=0,R=Math.max(T,P);R>l;l++){if(T>l){for(E[l]=0,c=l;i>c;c++)E[l]=y(E[l],o[c][l]);if(0!==E[l]){for(o[l][l]<0&&(E[l]=-E[l]),c=l;i>c;c++)o[c][l]/=E[l];o[l][l]+=1}E[l]=-E[l]}for(m=l+1;n>m;m++){if(T>l&&0!==E[l]){for(w=0,c=l;i>c;c++)w+=o[c][l]*o[c][m];for(w=-w/o[l][l],c=l;i>c;c++)o[c][m]+=w*o[c][l]}_[m]=o[l][m]}if(e&&T>l)for(c=l;i>c;c++)U[c][l]=o[c][l];if(P>l){for(_[l]=0,c=l+1;n>c;c++)_[l]=y(_[l],_[c]);if(0!==_[l]){for(_[l+1]<0&&(_[l]=-_[l]),c=l+1;n>c;c++)_[c]/=_[l];_[l+1]+=1}if(_[l]=-_[l],i>l+1&&0!==_[l]){for(c=l+1;i>c;c++)N[c]=0;for(m=l+1;n>m;m++)for(c=l+1;i>c;c++)N[c]+=_[m]*o[c][m];for(m=l+1;n>m;m++)for(w=-_[m]/_[l+1],c=l+1;i>c;c++)o[c][m]+=w*N[c]}if(a)for(c=l+1;n>c;c++)L[c][l]=_[c]}}if(d=Math.min(n,i+1),n>T&&(E[T]=o[T][T]),d>i&&(E[d-1]=0),d>P+1&&(_[P]=o[P][d-1]),_[d-1]=0,e){for(m=T;s>m;m++){for(c=0;i>c;c++)U[c][m]=0;U[m][m]=1}for(l=T-1;l>=0;l--)if(0!==E[l]){for(m=l+1;s>m;m++){for(w=0,c=l;i>c;c++)w+=U[c][l]*U[c][m];for(w=-w/U[l][l],c=l;i>c;c++)U[c][m]+=w*U[c][l]}for(c=l;i>c;c++)U[c][l]=-U[c][l];for(U[l][l]=1+U[l][l],c=0;l-1>c;c++)U[c][l]=0}else{for(c=0;i>c;c++)U[c][l]=0;U[l][l]=1}}if(a)for(l=n-1;l>=0;l--){if(P>l&&0!==_[l])for(m=l+1;n>m;m++){for(w=0,c=l+1;n>c;c++)w+=L[c][l]*L[c][m];for(w=-w/L[l+1][l],c=l+1;n>c;c++)L[c][m]+=w*L[c][l]}for(c=0;n>c;c++)L[c][l]=0;L[l][l]=1}for(var Q=d-1,W=0,B=Math.pow(2,-52);d>0;){for(l=d-2;l>=-1&&-1!==l;l--)if(Math.abs(_[l])<=B*(Math.abs(E[l])+Math.abs(E[l+1]))){_[l]=0;break}if(l===d-2)k=4;else{for(v=d-1;v>=l&&v!==l;v--)if(w=(v!==d?Math.abs(_[v]):0)+(v!==l+1?Math.abs(_[v-1]):0),Math.abs(E[v])<=B*w){E[v]=0;break}v===l?k=3:v===d-1?k=1:(k=2,l=v)}switch(l++,k){case 1:for(M=_[d-2],_[d-2]=0,m=d-2;m>=l;m--)if(w=y(E[m],M),x=E[m]/w,b=M/w,E[m]=w,m!==l&&(M=-b*_[m-1],_[m-1]=x*_[m-1]),a)for(c=0;n>c;c++)w=x*L[c][m]+b*L[c][d-1],L[c][d-1]=-b*L[c][m]+x*L[c][d-1],L[c][m]=w;break;case 2:for(M=_[l-1],_[l-1]=0,m=l;d>m;m++)if(w=y(E[m],M),x=E[m]/w,b=M/w,E[m]=w,M=-b*_[m],_[m]=x*_[m],e)for(c=0;i>c;c++)w=x*U[c][m]+b*U[c][l-1],U[c][l-1]=-b*U[c][m]+x*U[c][l-1],U[c][m]=w;break;case 3:for(D=Math.max(Math.max(Math.max(Math.max(Math.abs(E[d-1]),Math.abs(E[d-2])),Math.abs(_[d-2])),Math.abs(E[l])),Math.abs(_[l])),A=E[d-1]/D,S=E[d-2]/D,j=_[d-2]/D,O=E[l]/D,C=_[l]/D,I=((S+A)*(S-A)+j*j)/2,V=A*j*A*j,q=0,(0!==I||0!==V)&&(q=Math.sqrt(I*I+V),0>I&&(q=-q),q=V/(I+q)),M=(O+A)*(O-A)+q,z=O*C,m=l;d-1>m;m++){if(w=y(M,z),x=M/w,b=z/w,m!==l&&(_[m-1]=w),M=x*E[m]+b*_[m],_[m]=x*_[m]-b*E[m],z=b*E[m+1],E[m+1]=x*E[m+1],a)for(c=0;n>c;c++)w=x*L[c][m]+b*L[c][m+1],L[c][m+1]=-b*L[c][m]+x*L[c][m+1],L[c][m]=w;if(w=y(M,z),x=M/w,b=z/w,E[m]=w,M=x*_[m]+b*E[m+1],E[m+1]=-b*_[m]+x*E[m+1],z=b*_[m+1],_[m+1]=x*_[m+1],e&&i-1>m)for(c=0;i>c;c++)w=x*U[c][m]+b*U[c][m+1],U[c][m+1]=-b*U[c][m]+x*U[c][m+1],U[c][m]=w}_[d-2]=M,W+=1;break;case 4:if(E[l]<=0&&(E[l]=E[l]<0?-E[l]:0,a))for(c=0;Q>=c;c++)L[c][l]=-L[c][l];for(;Q>l&&!(E[l]>=E[l+1]);){if(w=E[l],E[l]=E[l+1],E[l+1]=w,a&&n-1>l)for(c=0;n>c;c++)w=L[c][l+1],L[c][l+1]=L[c][l],L[c][l]=w;if(e&&i-1>l)for(c=0;i>c;c++)w=U[c][l+1],U[c][l+1]=U[c][l],U[c][l]=w;l++}W=0,d--}}if(f){var X=L;L=U,U=X}return new p(i,n,E,U,L)}function p(t,r,o,i,n){this.m=t,this.n=r,this.s=o,this.U=i,this.V=n}function d(t){if(t=g.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");var r,o,i,n=t,s=n.rows,e=new g(s,s),a=!0;for(o=0;s>o;o++){var h=e[o],f=0;for(i=0;o>i;i++){var u=e[i],c=0;for(r=0;i>r;r++)c+=u[r]*h[r];h[i]=c=(n[o][i]-c)/e[i][i],f+=c*c}for(f=n[o][o]-f,a&=f>0,e[o][o]=Math.sqrt(Math.max(f,0)),i=o+1;s>i;i++)e[o][i]=0}if(!a)throw new Error("Matrix is not positive definite");return new w(e)}function w(t){this.L=t}function y(t,r){var o;return Math.abs(t)>Math.abs(r)?(o=r/t,Math.abs(t)*Math.sqrt(1+o*o)):0!==r?(o=t/r,Math.abs(r)*Math.sqrt(1+o*o)):0}function v(t){return M(t,g.eye(t.rows))}function M(t,r){return t.isSquare()?new f(t).solve(r):new c(t).solve(r)}var g=t("./matrix");h.prototype={get realEigenvalues(){return this.d},get imaginaryEigenvalues(){return this.e},get eigenvectorMatrix(){return this.V},get diagonalMatrix(){var t,r,o=this.n,i=this.e,n=this.d,s=new g(o,o);for(t=0;o>t;t++){for(r=0;o>r;r++)s[t][r]=0;s[t][t]=n[t],i[t]>0?s[t][t+1]=i[t]:i[t]<0&&(s[t][t-1]=i[t])}return s}},u.prototype={isSingular:function(){for(var t=this.LU,r=t.columns,o=0;r>o;o++)if(0===t[o][o])return!0;return!1},get determinant(){var t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");for(var r=this.pivotSign,o=t.columns,i=0;o>i;i++)r*=t[i][i];return r},get lowerTriangularFactor(){for(var t=this.LU,r=t.rows,o=t.columns,i=new g(r,o),n=0;r>n;n++)for(var s=0;o>s;s++)i[n][s]=n>s?t[n][s]:n===s?1:0;return i},get upperTriangularFactor(){for(var t=this.LU,r=t.rows,o=t.columns,i=new g(r,o),n=0;r>n;n++)for(var s=0;o>s;s++)i[n][s]=s>=n?t[n][s]:0;return i},get pivotPermutationVector(){return this.pivotVector.slice()},solve:function(t){t=g.checkMatrix(t);var r=this.LU,o=r.rows;if(o!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var i,n,s,e=t.columns,a=t.subMatrixRow(this.pivotVector,0,e-1),h=r.columns;for(s=0;h>s;s++)for(i=s+1;h>i;i++)for(n=0;e>n;n++)a[i][n]-=a[s][n]*r[i][s];for(s=h-1;s>=0;s--){for(n=0;e>n;n++)a[s][n]/=r[s][s];for(i=0;s>i;i++)for(n=0;e>n;n++)a[i][n]-=a[s][n]*r[i][s]}return a}},m.prototype={solve:function(t){t=g.checkMatrix(t);var r=this.QR,o=r.rows;if(t.rows!==o)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var i,n,s,e,a=t.columns,h=t.clone(),f=r.columns;for(s=0;f>s;s++)for(n=0;a>n;n++){for(e=0,i=s;o>i;i++)e+=r[i][s]*h[i][n];for(e=-e/r[s][s],i=s;o>i;i++)h[i][n]+=e*r[i][s]}for(s=f-1;s>=0;s--){for(n=0;a>n;n++)h[s][n]/=this.Rdiag[s];for(i=0;s>i;i++)for(n=0;a>n;n++)h[i][n]-=h[s][n]*r[i][s]}return h.subMatrix(0,f-1,0,a-1)},isFullRank:function(){for(var t=this.QR.columns,r=0;t>r;r++)if(0===this.Rdiag[r])return!1;return!0},get upperTriangularFactor(){var t,r,o=this.QR,i=o.columns,n=new g(i,i);for(t=0;i>t;t++)for(r=0;i>r;r++)n[t][r]=r>t?o[t][r]:t===r?this.Rdiag[t]:0;return n},get orthogonalFactor(){var t,r,o,i,n=this.QR,s=n.rows,e=n.columns,a=new g(s,e);for(o=e-1;o>=0;o--){for(t=0;s>t;t++)a[t][o]=0;for(a[o][o]=1,r=o;e>r;r++)if(0!==n[o][o]){for(i=0,t=o;s>t;t++)i+=n[t][o]*a[t][r];for(i=-i/n[o][o],t=o;s>t;t++)a[t][r]+=i*n[t][o]}}return a}},p.prototype={get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},get norm2(){return this.s[0]},get rank(){for(var t=Math.pow(2,-52),r=Math.max(this.m,this.n)*this.s[0]*t,o=0,i=this.s,n=0,s=i.length;s>n;n++)i[n]>r&&o++;return o},get diagonal(){return this.s},get threshold(){return Math.pow(2,-52)/2*Math.max(this.m,this.n)*this.s[0]},get leftSingularVectors(){return this.U},get rightSingularVectors(){return this.V},get diagonalMatrix(){return g.diag(this.s)},solve:function(t){var r,o=t,i=this.threshold,n=this.s.length,s=g.zeros(n,n);for(r=0;n>r;r++)s[r][r]=Math.abs(this.s[r])<=i?0:1/this.s[r];var e,a,h,f=this.V.mmul(s),u=this.V.rows,c=this.U.rows,m=g.zeros(u,c);for(r=0;u>r;r++)for(e=0;c>e;e++){for(h=0,a=0;n>a;a++)h+=f[r][a]*this.U[e][a];m[r][e]=h}return m.mmul(o)},solveForDiagonal:function(t){return this.solve(g.diag(t))},inverse:function(){var t,r,o=this.threshold,i=this.V.rows,n=this.V.columns,s=new g(i,this.s.length);for(t=0;i>t;t++)for(r=0;n>r;r++)Math.abs(this.s[r])>o&&(s[t][r]=this.V[t][r]/this.s[r]);var e,a,h=this.U.rows,f=this.U.columns,u=new g(i,h);for(t=0;i>t;t++)for(r=0;h>r;r++){for(a=0,e=0;f>e;e++)a+=s[t][e]*this.U[r][e];u[t][r]=a}return u}},w.prototype={get leftTriangularFactor(){return this.L},solve:function(t){t=g.checkMatrix(t);var r=this.L,o=r.rows;if(t.rows!==o)throw new Error("Matrix dimensions do not match");var i,n,s,e=t.columns,a=t.clone();for(s=0;o>s;s++)for(n=0;e>n;n++){for(i=0;s>i;i++)a[s][n]-=a[i][n]*r[s][i];a[s][n]/=r[s][s]}for(s=o-1;s>=0;s--)for(n=0;e>n;n++){for(i=s+1;o>i;i++)a[s][n]-=a[i][n]*r[i][s];a[s][n]/=r[s][s]}return a}},r.exports={LuDecomposition:f,LU:f,QrDecomposition:c,QR:c,SingularValueDecomposition:l,SVD:l,EigenvalueDecomposition:o,EVD:o,CholeskyDecomposition:d,CHO:d,inverse:v,solve:M}},{"./matrix":4}],3:[function(t,r){"use strict";r.exports=t("./matrix"),r.exports.Decompositions=r.exports.DC=t("./decompositions")},{"./decompositions":2,"./matrix":4}],4:[function(t,r){"use strict";function o(t){for(var r=0,o=t.length,i=new Array(o);o>r;r++)i[r]=t[r];return i}function i(t){this.message=t||"Unknown matrix error"}function n(t){throw new i(t)}function s(t,r){var i,e,a=0;if(t instanceof Array)if(e=r,i=e?o(t):t,t=i.length,r=i[0].length,"undefined"==typeof r&&n("Data must be a 2D array"),t>0&&r>0)for(;t>a;a++)i[a].length!==r?n("Inconsistent array dimensions"):e&&(i[a]=o(i[a]));else n("Invalid dimensions: "+t+"x"+r);else if("number"==typeof t)if(t>0&&r>0)for(i=new Array(t);t>a;a++)i[a]=new Array(r);else n("Invalid dimensions: "+t+"x"+r);else n("Invalid arguments");return Object.defineProperty(i,"rows",{writable:!0,value:t}),Object.defineProperty(i,"columns",{writable:!0,value:r}),i.__proto__=s.prototype,i}var e=Array.prototype.splice,a=Array.prototype.concat;i.prototype=Object.create(Error.prototype),i.prototype.name="MatrixError",i.prototype.constructor=i,s.from1DArray=function(t,r,o){var i,e,a=0;for(i=t*r,i!==o.length&&n("Data length does not match given dimensions"),e=new Array(t);t>a;a++)e[a]=o.slice(a*r,(a+1)*r);return new s(e)},s.rowVector=function(t){return new s([t])},s.columnVector=function(t){for(var r=t.length,o=new Array(r),i=0;r>i;i++)o[i]=[t[i]];return new s(o)},s.empty=function(t,r){return new s(t,r)},s.zeros=function(t,r){return s.empty(t,r).fill(0)},s.ones=function(t,r){return s.empty(t,r).fill(1)},s.rand=function(t,r){for(var o=s.empty(t,r),i=0,n=o.rows;n>i;i++)for(var e=0,a=o.columns;a>e;e++)o[i][e]=Math.random();return o},s.eye=function(t){for(var r=s.zeros(t,t),o=r.rows,i=0;o>i;i++)r[i][i]=1;return r},s.diag=function(t){for(var r=t.length,o=s.zeros(r,r),i=0;r>i;i++)o[i][i]=t[i];return o},s.indices=function(t,r){for(var o=new Array(r-t),i=0;i<o.length;i++)o[i]=t++;return o},s.stack=function(t){var r,o,i;if(s.isMatrix(t)){var n=0,e=0;for(r=0;r<arguments.length;r++)n+=arguments[r].rows,arguments[r].columns>e&&(e=arguments[r].columns);var a=s.zeros(n,e),h=0;for(r=0;r<arguments.length;r++){var f=arguments[r];for(o=0;o<f.rows;o++){for(i=0;i<f.columns;i++)a[h][i]=f[o][i];h++}}return a}if(t instanceof Array){var u=s.empty(arguments.length,t.length);for(r=0;r<arguments.length;r++)u.setRow(r,arguments[r]);return u}},s.expand=function(t,r){for(var o=[],i=0;i<r.length;i++)for(var n=0;n<r[i];n++)o.push(t[i]);return new s(o)},s.checkMatrix=function(t){return t||n("Argument has to be a matrix"),"Matrix"!==t.klass&&(t=new s(t)),t},s.isMatrix=function(t){return t?"Matrix"===t.klass:!1},Object.defineProperty(s.prototype,"klass",{get:function(){return"Matrix"}}),Object.defineProperty(s.prototype,"size",{get:function(){return this.rows*this.columns}}),s.prototype.checkRowIndex=function(t){(0>t||t>this.rows-1)&&n("Row index out of range.")},s.prototype.checkColumnIndex=function(t){(0>t||t>this.columns-1)&&n("Column index out of range.")},s.prototype.checkDimensions=function(t){(this.rows!==t.rows||this.columns!==t.columns)&&n("Matrices dimensions must be equal.")},s.prototype.apply=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t.call(this,i,n);return this},s.prototype.clone=function(){return new s(this.to2DArray())},s.prototype.to1DArray=function(){return a.apply([],this)},s.prototype.to2DArray=function(){for(var t=this.rows,r=new Array(t),i=0;t>i;i++)r[i]=o(this[i]);return r},s.prototype.isRowVector=function(){return 1===this.rows},s.prototype.isColumnVector=function(){return 1===this.columns},s.prototype.isVector=function(){return 1===this.rows||1===this.columns},s.prototype.isSquare=function(){return this.rows===this.columns},s.prototype.isSymmetric=function(){if(this.isSquare()){for(var t=this.rows,r=0;t>r;r++)for(var o=0;r>=o;o++)if(this[r][o]!==this[o][r])return!1;return!0}return!1},s.prototype.set=function(t,r,o){return this[t][r]=o,this},s.prototype.get=function(t,r){return this[t][r]},s.prototype.fill=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]=t;return this},s.prototype.neg=function(){return this.mulS(-1)},s.prototype.add=function(t){return"number"==typeof t?this.addS(t):(t=s.checkMatrix(t),this.addM(t))},s.prototype.addS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t;return this},s.prototype.addM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t[i][n];return this},s.prototype.sub=function(t){return"number"==typeof t?this.subS(t):(t=s.checkMatrix(t),this.subM(t))},s.prototype.subS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t;return this},s.prototype.subM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t[i][n];return this},s.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):(t=s.checkMatrix(t),this.mulM(t))},s.prototype.mulS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t;return this},s.prototype.mulM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t[i][n];return this},s.prototype.div=function(t){return"number"==typeof t?this.divS(t):(t=s.checkMatrix(t),this.divM(t))},s.prototype.divS=function(t){for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t;return this},s.prototype.divM=function(t){this.checkDimensions(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t[i][n];return this},s.prototype.getRow=function(t){return this.checkRowIndex(t),o(this[t])},s.prototype.setRow=function(t,r){return this.checkRowIndex(t),s.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns&&n("Invalid row size"),this[t]=o(r),this},s.prototype.removeRow=function(t){return this.checkRowIndex(t),1===this.rows&&n("A matrix cannot have less than one row"),e.call(this,t,1),this.rows-=1,this},s.prototype.addRow=function(t,r){return"undefined"==typeof r&&(r=t,t=this.rows),(0>t||t>this.rows)&&n("Row index out of range."),s.isMatrix(r)&&(r=r.to1DArray()),r.length!==this.columns&&n("Invalid row size"),e.call(this,t,0,o(r)),this.rows+=1,this},s.prototype.swapRows=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);var o=this[t];return this[t]=this[r],this[r]=o,this},s.prototype.getColumn=function(t){this.checkColumnIndex(t);for(var r=this.rows,o=new Array(r),i=0;r>i;i++)o[i]=this[i][t];return o},s.prototype.setColumn=function(t,r){this.checkColumnIndex(t),s.isMatrix(r)&&(r=r.to1DArray());var o=this.rows;r.length!==o&&n("Invalid column size");for(var i=0;o>i;i++)this[i][t]=r[i];return this},s.prototype.removeColumn=function(t){this.checkColumnIndex(t),1===this.columns&&n("A matrix cannot have less than one column");for(var r=0,o=this.rows;o>r;r++)this[r].splice(t,1);return this.columns-=1,this},s.prototype.addColumn=function(t,r){"undefined"==typeof r&&(r=t,t=this.columns),(0>t||t>this.columns)&&n("Column index out of range."),s.isMatrix(r)&&(r=r.to1DArray());var o=this.rows;r.length!==o&&n("Invalid column size");for(var i=0;o>i;i++)this[i].splice(t,0,r[i]);return this.columns+=1,this},s.prototype.swapColumns=function(t,r){this.checkRowIndex(t),this.checkRowIndex(r);for(var o,i,n=this.rows,s=0;n>s;s++)i=this[s],o=i[t],i[t]=i[r],i[r]=o;return this},s.prototype.checkRowVector=function(t){return s.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.columns&&n("vector size must be the same as the number of columns"),t},s.prototype.checkColumnVector=function(t){return s.isMatrix(t)&&(t=t.to1DArray()),t.length!==this.rows&&n("vector size must be the same as the number of rows"),t},s.prototype.addRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t[n];return this},s.prototype.subRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t[n];return this},s.prototype.mulRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t[n];return this},s.prototype.divRowVector=function(t){t=this.checkRowVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t[n];return this},s.prototype.addColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]+=t[i];return this},s.prototype.subColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]-=t[i];return this},s.prototype.mulColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]*=t[i];return this},s.prototype.divColumnVector=function(t){t=this.checkColumnVector(t);for(var r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]/=t[i];return this},s.prototype.mulRow=function(t,r){this.checkRowIndex(t);for(var o=0,i=this.columns;i>o;o++)this[t][o]*=r;return this},s.prototype.mulColumn=function(t,r){this.checkColumnIndex(t);for(var o=0,i=this.rows;i>o;o++)this[o][t]*=r},s.prototype.max=function(){for(var t=-1/0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]>t&&(t=this[i][n]);return t},s.prototype.maxIndex=function(){for(var t=-1/0,r={},o=this.rows,i=this.columns,n=0;o>n;n++)for(var s=0;i>s;s++)this[n][s]>t&&(t=this[n][s],r.row=n,r.column=s);return r},s.prototype.min=function(){for(var t=1/0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)this[i][n]<t&&(t=this[i][n]);return t},s.prototype.minIndex=function(){for(var t=1/0,r={},o=this.rows,i=this.columns,n=0;o>n;n++)for(var s=0;i>s;s++)this[n][s]<t&&(t=this[n][s],r.row=n,r.column=s);return r},s.prototype.maxRow=function(t){this.checkRowIndex(t);for(var r=-1/0,o=0,i=this.columns;i>o;o++)this[t][o]>r&&(r=this[t][o]);return r},s.prototype.maxRowIndex=function(t){this.checkRowIndex(t);for(var r=-1/0,o={row:t},i=0,n=this.columns;n>i;i++)this[t][i]>r&&(r=this[t][i],o.column=i);return o},s.prototype.minRow=function(t){this.checkRowIndex(t);for(var r=1/0,o=0,i=this.columns;i>o;o++)this[t][o]<r&&(r=this[t][o]);return r},s.prototype.minRowIndex=function(t){this.checkRowIndex(t);for(var r=1/0,o={row:t,column:0},i=0,n=this.columns;n>i;i++)this[t][i]<r&&(r=this[t][i],o.column=i);return o},s.prototype.maxColumn=function(t){this.checkColumnIndex(t);for(var r=-1/0,o=0,i=this.rows;i>o;o++)this[o][t]>r&&(r=this[o][t]);return r},s.prototype.maxColumnIndex=function(t){this.checkColumnIndex(t);for(var r=-1/0,o={row:0,column:t},i=0,n=this.rows;n>i;i++)this[i][t]>r&&(r=this[i][t],o.row=i);return o},s.prototype.minColumn=function(t){this.checkColumnIndex(t);for(var r=1/0,o=0,i=this.rows;i>o;o++)this[o][t]<r&&(r=this[o][t]);return r},s.prototype.minColumnIndex=function(t){this.checkColumnIndex(t);for(var r=1/0,o={row:0,column:t},i=0,n=this.rows;n>i;i++)this[i][t]<r&&(r=this[i][t],o.row=i);return o},s.prototype.diag=function h(){this.isSquare()||n("Only square matrices have a diagonal.");for(var h=new Array(this.rows),t=0,r=this.rows;r>t;t++)h[t]=this[t][t];return h},s.prototype.sum=function(){for(var t=0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t+=this[i][n];return t},s.prototype.mean=function(){return this.sum()/this.size},s.prototype.prod=function f(){for(var f=1,t=this.rows,r=this.columns,o=0;t>o;o++)for(var i=0;r>i;i++)f*=this[o][i];return f},s.prototype.cumulativeSum=function(){for(var t=0,r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t+=this[i][n],this[i][n]=t;return this},s.prototype.dot=function u(t){this.size!==t.size&&n("vectors do not have the same size");for(var r=this.to1DArray(),o=t.to1DArray(),u=0,i=r.length,s=0;i>s;s++)u+=r[s]*o[s];return u},s.prototype.mmul=function(t){this.columns!==t.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");var r,o,i,n=this.rows,e=this.columns,a=t.columns,h=new s(n,a),f=new Array(e);for(o=0;a>o;o++){for(i=0;e>i;i++)f[i]=t[i][o];for(r=0;n>r;r++){var u=this[r],c=0;for(i=0;e>i;i++)c+=u[i]*f[i];h[r][o]=c}}return h},s.prototype.sortRows=function(t){for(var r=0,o=this.rows;o>r;r++)this[r].sort(t);return this},s.prototype.sortColumns=function(t){for(var r=0,o=this.columns;o>r;r++)this.setColumn(r,this.getColumn(r).sort(t));return this},s.prototype.transpose=function(){for(var t=new s(this.columns,this.rows),r=this.rows,o=this.columns,i=0;r>i;i++)for(var n=0;o>n;n++)t[n][i]=this[i][n];return t},s.prototype.subMatrix=function(t,r,o,i){(t>r||o>i||0>t||t>=this.rows||0>r||r>=this.rows||0>o||o>=this.columns||0>i||i>=this.columns)&&n("Argument out of range");for(var e=new s(r-t+1,i-o+1),a=t;r>=a;a++)for(var h=o;i>=h;h++)e[a-t][h-o]=this[a][h];return e},s.prototype.subMatrixRow=function(t,r,o){"undefined"==typeof r?(r=0,o=this.columns-1):"undefined"==typeof o&&(o=this.columns-1),(r>o||0>r||r>=this.columns||0>o||o>=this.columns)&&n("Argument out of range.");for(var i=t.length,e=this.rows,a=new s(i,o-r+1),h=0;i>h;h++)for(var f=r;o>=f;f++)(t[h]<0||t[h]>=e)&&n("Argument out of range."),a[h][f-r]=this[t[h]][f];return a},s.prototype.subMatrixColumn=function(t,r,o){"undefined"==typeof r?(r=0,o=this.rows-1):"undefined"==typeof o&&(o=this.rows-1),(r>o||0>r||r>=this.rows||0>o||o>=this.rows)&&n("Argument out of range.");for(var i=t.length,e=this.columns,a=new s(o-r+1,i),h=0;i>h;h++)for(var f=r;o>=f;f++)(t[h]<0||t[h]>=e)&&n("Argument out of range."),a[f-r][h]=this[f][t[h]];return a},s.prototype.trace=function c(){this.isSquare()||n("The matrix is not square");for(var c=0,t=0,r=this.rows;r>t;t++)c+=this[t][t];return c},s.prototype.abs=function(){for(var t=this.rows,r=this.columns,o=0;t>o;o++)for(var i=0;r>i;i++)this[o][i]=Math.abs(this[o][i])},s.MatrixError=i,r.exports=s},{}],5:[function(t,r){r.exports=t("./som")},{"./som":8}],6:[function(t,r){function o(t,r,o,n){i.call(this,t,r,o,n),this.hX=t-Math.floor(r/2),this.z=0-this.hX-r}var i=t("./node-square");o.prototype=new i,o.prototype.constructor=o,o.prototype.getDistance=function(t){return Math.max(Math.abs(this.hX-t.hX),Math.abs(this.y-t.y),Math.abs(this.z-t.z))},o.prototype.getDistanceTorus=function(t){var r=Math.abs(this.hX-t.hX),o=Math.abs(this.y-t.y),i=Math.abs(this.z-t.z);return Math.max(Math.min(r,this.som.gridDim.x-r),Math.min(o,this.som.gridDim.y-o),Math.min(i,this.som.gridDim.z-i))},o.prototype.getPosition=function(){throw new Error("Unimplemented : cannot get position of the points for hexagonal grid")},r.exports=o},{"./node-square":7}],7:[function(t,r){function o(t,r,o,i){this.x=t,this.y=r,this.weights=o,this.som=i
}o.prototype.adjustWeights=function(t,r,o){for(var i=0,n=this.weights.length;n>i;i++)this.weights[i]+=r*o*(t[i]-this.weights[i])},o.prototype.getDistance=function(t){return Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))},o.prototype.getDistanceTorus=function(t){var r=Math.abs(this.x-t.x),o=Math.abs(this.y-t.y);return Math.max(Math.min(r,this.som.gridDim.x-r),Math.min(o,this.som.gridDim.y-o))},o.prototype.getPosition=function(t){for(var r,o,i=this.neighbors||this.getNeighbors(),n=[.5,.5],s=0;s<i.length;s++){r=i[s],o=1-this.som.distance(r.weights,t)/this.som.maxDistance;var e=r.x-this.x;e>1?e=-1:-1>e&&(e=1),n[0]+=e*o*.5;var a=r.y-this.y;a>1?a=-1:-1>a&&(a=1),n[1]+=a*o*.5}return n},o.prototype.getNeighbors=function(){for(var t=[],r=-1;1>=r;r++){var o=this.x+r;if(0>o){if(!this.som.torus)continue;o=this.som.gridDim.x-1}else if(o===this.som.gridDim.x){if(!this.som.torus)continue;o=0}for(var i=-1;1>=i;i++)if(0!==r||0!==i){var n=this.y+i;if(0>n){if(!this.som.torus)continue;n=this.som.gridDim.y-1}else if(n===this.som.gridDim.y){if(!this.som.torus)continue;n=0}t.push(this.som.nodes[o][n])}}return this.neighbors=t},r.exports=o},{}],8:[function(require,module,exports){"use strict";function SOM(t,r,o,i){this.x=t,this.y=r,o=o||{},this.options={};for(var n in defaultOptions)this.options[n]=o.hasOwnProperty(n)?o[n]:defaultOptions[n];if("number"==typeof this.options.fields)this.numWeights=this.options.fields,this.extractor=null;else{var s=Object.keys(this.options.fields);this.numWeights=s.length;var e=getConverters(s,this.options.fields);this.extractor=e.extractor,this.creator=e.creator}if("rect"===this.options.gridType)this.nodeType=NodeSquare,this.gridDim={x:t,y:r};else{this.nodeType=NodeHexagonal;var a=this.x-Math.floor(this.y/2);this.gridDim={x:a,y:this.y,z:-(0-a-this.y)}}if(this.torus=this.options.torus,this.distanceMethod=this.torus?"getDistanceTorus":"getDistance",this.distance=this.options.distance,this.maxDistance=getMaxDistance(this.distance,this.numWeights),i===!0)return void(this.done=!0);if(!(t>0&&r>0))throw new Error("x and y must be positive");this.times={findBMU:0,adjust:0},this.randomizer=this.options.randomizer,this.iterationCount=0,this.iterations=this.options.iterations,this.startLearningRate=this.learningRate=this.options.learningRate,this.mapRadius=Math.floor(Math.max(t,r)/2),this.algorithmMethod=this.options.method,this._initNodes(),this.done=!1}function getConverters(t,r){for(var o=t.length,i=new Array(o),n=new Array(o),s=0;o>s;s++)i[s]=getNormalizer(r[t[s]]),n[s]=getDenormalizer(r[t[s]]);return{extractor:function(r){for(var n=new Array(o),s=0;o>s;s++)n[s]=i[s](r[t[s]]);return n},creator:function(r){for(var i={},s=0;o>s;s++)i[t[s]]=n[s](r[s]);return i}}}function getNormalizer(t){return function(r){return(r-t[0])/(t[1]-t[0])}}function getDenormalizer(t){return function(r){return t[0]+r*(t[1]-t[0])}}function squareEuclidean(t,r){for(var o=0,i=0,n=t.length;n>i;i++)o+=(t[i]-r[i])*(t[i]-r[i]);return o}function getRandomValue(t,r){return t[Math.floor(r()*t.length)]}function getMaxDistance(t,r){for(var o=new Array(r),i=new Array(r),n=0;r>n;n++)o[n]=0,i[n]=1;return t(o,i)}var NodeSquare=require("./node-square"),NodeHexagonal=require("./node-hexagonal"),defaultOptions={fields:3,randomizer:Math.random,distance:squareEuclidean,iterations:10,learningRate:.1,gridType:"rect",torus:!0,method:"random"};SOM.load=function loadModel(model,distance){if("SOM"===model.name){var x=model.data.length,y=model.data[0].length;distance?model.options.distance=distance:model.options.distance&&(model.options.distance=eval("("+model.options.distance+")"));var som=new SOM(x,y,model.options,!0);som.nodes=new Array(x);for(var i=0;x>i;i++){som.nodes[i]=new Array(y);for(var j=0;y>j;j++)som.nodes[i][j]=new som.nodeType(i,j,model.data[i][j],som)}return som}throw new Error("expecting a SOM model")},SOM.prototype.export=function(t){if(!this.done)throw new Error("model is not ready yet");var r={name:"SOM"};r.options={fields:this.options.fields,gridType:this.options.gridType,torus:this.options.torus},r.data=new Array(this.x);for(var o=0;o<this.x;o++){r.data[o]=new Array(this.y);for(var i=0;i<this.y;i++)r.data[o][i]=this.nodes[o][i].weights}return t&&(r.options.distance=this.distance.toString()),r},SOM.prototype._initNodes=function(){var t,r,o,i=Date.now();for(this.nodes=new Array(this.x),t=0;t<this.x;t++)for(this.nodes[t]=new Array(this.y),r=0;r<this.y;r++){var n=new Array(this.numWeights);for(o=0;o<this.numWeights;o++)n[o]=this.randomizer();this.nodes[t][r]=new this.nodeType(t,r,n,this)}this.times.initNodes=Date.now()-i},SOM.prototype.setTraining=function(t){if(this.trainingSet)throw new Error("training set has already been set");var r,o=Date.now(),i=t,n=t.length;if(this.extractor)for(i=new Array(t),r=0;n>r;r++)i[r]=this.extractor(t[r]);this.numIterations=this.iterations*n,this.timeConstant="random"===this.algorithmMethod?this.numIterations/Math.log(this.mapRadius):n/Math.log(this.mapRadius),this.trainingSet=i,this.times.setTraining=Date.now()-o},SOM.prototype.trainOne=function(){if(this.done)return!1;if(this.numIterations-->0){var t,r,o;return"random"===this.algorithmMethod?(t=this.mapRadius*Math.exp(-this.iterationCount/this.timeConstant),r=getRandomValue(this.trainingSet,this.randomizer),this._adjust(r,t),this.learningRate=this.startLearningRate*Math.exp(-this.iterationCount/this.numIterations)):(o=-Math.floor(this.iterationCount/this.trainingSet.length),t=this.mapRadius*Math.exp(o/this.timeConstant),r=this.trainingSet[this.iterationCount%this.trainingSet.length],this._adjust(r,t),(this.iterationCount+1)%this.trainingSet.length===0&&(this.learningRate=this.startLearningRate*Math.exp(o/Math.floor(this.numIterations/this.trainingSet.length)))),this.iterationCount++,!0}return this.done=!0,!1},SOM.prototype._adjust=function(t,r){var o,i,n,s,e=Date.now(),a=this._findBestMatchingUnit(t),h=Date.now();this.times.findBMU+=h-e;var f=Math.floor(r),u=a.x-f,c=a.x+f,m=a.y-f,l=a.y+f;for(o=u;c>=o;o++){var p=o;for(0>o?p+=this.x:o>=this.x&&(p-=this.x),i=m;l>=i;i++){var d=i;0>i?d+=this.y:i>=this.y&&(d-=this.y),n=a[this.distanceMethod](this.nodes[p][d]),r>n&&(s=Math.exp(-n/(2*r)),this.nodes[p][d].adjustWeights(t,this.learningRate,s))}}this.times.adjust+=Date.now()-h},SOM.prototype.train=function(t){if(!this.done)for(this.setTraining(t);this.trainOne(););},SOM.prototype.getConvertedNodes=function(){for(var t=new Array(this.x),r=0;r<this.x;r++){t[r]=new Array(this.y);for(var o=0;o<this.y;o++){var i=this.nodes[r][o];t[r][o]=this.creator?this.creator(i.weights):i.weights}}return t},SOM.prototype._findBestMatchingUnit=function(t){for(var r,o,i=1/0,n=0;n<this.x;n++)for(var s=0;s<this.y;s++)o=this.distance(this.nodes[n][s].weights,t),i>o&&(i=o,r=this.nodes[n][s]);return r},SOM.prototype.predict=function(t,r){if(t instanceof Array&&t[0]instanceof Array){var o=this;return t.map(function(t){return o._predict(t,r)})}return this._predict(t,r)},SOM.prototype._predict=function(t,r){t instanceof Array||(t=this.extractor(t));var o=this._findBestMatchingUnit(t),i=[o.x,o.y];return r&&(i[2]=o.getPosition(t)),i},SOM.prototype.getQuantizationError=function(){for(var t,r=this.trainingSet,o=r.length,i=0,n=0;o>n;n++)t=this._findBestMatchingUnit(r[n]),i+=Math.sqrt(squareEuclidean(r[n],t.weights));return i/o},module.exports=SOM},{"./node-hexagonal":6,"./node-square":7}]},{},[1])(1)});